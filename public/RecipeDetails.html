
<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
		<meta name="generator" content="Jekyll v3.8.5">
		<title>Search Results</title>

		<!-- Bootstrap core CSS -->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<script src="login.js"></script>
		<script src="userStatus.js"></script>
		<style>
			.bd-placeholder-img {
				font-size: 1.125rem;
				text-anchor: middle;
				-webkit-user-select: none;
				-moz-user-select: none;
				-ms-user-select: none;
				user-select: none;
			}

			@media (min-width: 768px) {
				.bd-placeholder-img-lg {
					font-size: 3.5rem;
				}
			}
			
			.row {
			    display: -ms-flexbox;
			    display: flex;
			    -ms-flex-wrap: wrap;
			    flex-wrap: wrap;
			    margin-right: -15px;
			    margin-left: -15px;
			    margin-bottom: 22px;
			}
			.sidenav {
				height: 120%;
				width: 0;
				position: fixed;
				z-index: 1;
				top: 0;
				right: 0;
				background-color: #ffffff;
				overflow-x: hidden;
				transition: 0.5s;
				padding-top: 80px;
			}

			.sidenav a {
				padding: 8px 8px 8px 32px;
				text-decoration: none;
				font-size: 25px;
				color: #818181;
				display: block;
				transition: 0.3s;
			}

			.sidenav a:hover {
				color: #f1f1f1;
			}

			.sidenav .closebtn {
				position: absolute;
				top: 0;
				right: 25px;
				font-size: 30px;
				margin-left: 50px;
				padding-top: 60px;
			}
			
			.results {
				overflow: hidden;
			}
		</style>
		<!-- Custom styles for this template -->
		<link href="jumbotron.css" rel="stylesheet">
	</head>
	<body>
		<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
			<a class="navbar-brand ml-3" href="index.html">&#10086; EasyMeals</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>

			<div class="collapse navbar-collapse" id="navbarsExampleDefault">
				<ul class="navbar-nav ml-auto mr-3 w-100 justify-content-end">
					<li class="nav-item active">
						<a class="nav-link" href="Index.html">Home <span class="sr-only">(current)</span></a>
					</li>
					<li id="accountItem" class="nav-item">
						<a class="nav-link" href="Account.html">Account</a>
					</li>
					<li id="savedRecipes" class="nav-item">
						<a class="nav-link" href="javascript:void(0)">Saved Recipes</a>
					</li>
					<li id="signInItem"	class="nav-item" style="padding-right: 20px">
						<a class="nav-link" onclick="openNavLog()">Sign in</a>
					</li>
					<li id="signUpItem"	class="nav-item active">
						<a class="nav-link btn-primary rounded" href="SignUp.html" role="button" style="width: 150px;text-align: center;">Sign up &#9753;</a>
					</li>
					<li id="logOutItem"	class="nav-item">
						<a class="nav-link" href="index.html">Log out</a>
					</li>
				</ul>
    
			</div>
		</nav>

		<main role="main">
			<!-- Main jumbotron for a primary marketing message or call to action -->
			<div class="jumbotron" style="margin-top: 30px;background-color: #ffffff">
				<div class="container">
					<!-- Example row of columns -->
					<div class="row border-bottom">
						<div><br /><br /></div>
						<h1 id="titleCard"></h1>
						<div class="col-md-4">
							<p><a id="testBtn" class="btn btn-primary btn-lg" role="button" style="width: 150px" hidden>Search &raquo;</a></p>
						</div>
	    	
					</div>
					
					<div id="results" class="table" style="margin-top: 13px">
						
					</div>

					<hr>

				</div> <!-- /container -->	
			</div>

		</main>

		<!-- sideBar Login -->
		<div id="mySidenavLogin" class="sidenav text-center border-left">			
			<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
			<div class="py-5 text-center">			
				<h4 class="font-weight-bold">Welcome to EasyMeals</h4>
			</div>
			<div class="col-md-9 order-md-1" style="margin: auto">      
					<div class="mb-3">
						<label for="email">Email</label>
						<input type="email" class="form-control" id="emailLogin" placeholder="you@example.com" value="" required="">
						<div class="invalid-feedback">
							Please enter a valid email address.
						</div>
					</div>
					
					<div class="mb-3">
						<label for="password">Password <span class="text-muted">(8 or more characters)</span></label>
						<input type="password" class="form-control" id="passwordLogin" placeholder="Password" value="" required="">
						<div class="invalid-feedback">
							Please enter a valid password.
						</div>
					</div>
					
					<hr class="mb-4">
					<button class="btn btn-primary btn-lg btn-default" type="submit" onclick="processLogin($('#emailLogin').val(),$('#passwordLogin').val())" >Login</button>
					
					<a href="SignUp.html" style="font-size: 15px;margin-right: 18px;text-decoration: underline;margin-top: 10px">Don't have an account? Sign up</a>
					
			</div>
			
			<div style="padding-top: 200px" ></div>
			
			<div style="height: 200px;padding-top: 50px;background:url('Images/footer.jpg');background-size: contain;">
				<h6>Â© 2019 EasyMeals</h6>
			</div>	
			
		</div>

		<footer class="container">
			<p>&copy; EasyMeals 2019</p>
		</footer>
				
		
		<script src="./CSS/form-validation.js.download"></script>
		
		<script>
		
		function openNavReg() {
			document.getElementById("mySidenav").style.width = "500px";
		}
		
		function openNavLog() {
			document.getElementById("mySidenavLogin").style.width = "500px";
		}

		function closeNav() {
			document.getElementById("mySidenav").style.width = "0";
			document.getElementById("mySidenavLogin").style.width = "0px";
		}
				
			
		$(function(){
			var status = getUserStatus();
			
			if(status == 'true'){
				$("#signInItem").hide();
				$("#signUpItem").hide();
				$("#accountItem").show();
				$("#logOutItem").show();
			}else{
				$("#signInItem").show();
				$("#signUpItem").show();
				$("#accountItem").hide();
				$("#logOutItem").hide();
			}
  			// jQuery methods go here...
			clearDisplay();			
			var display = document.getElementById("results");
			var titleCard = document.getElementById("titleCard");
			
			var recipeResult = window.location.hash.substring(1);
			
			
			function getData(recipeResult){
				
				$.ajax({
						url: '/api/query/getRecipeById',
						type: 'POST',
						contentType: 'application/json',
						data: JSON.stringify({"recipeId":recipeResult}),
						success: function(res){
													
							var text = "<div class='row fixed' style='margin-bottom:22px'>";
							text += "<div class='col rounded'><p><img class='rounded' src='https://spoonacular.com/recipeImages/"+recipeResult+"-556x370.jpg'/></p></div><div class='col rounded'><h1 class='h5'>Ingredients</h1><p>";
							for(var count=0;count<res.extendedIngredients.length;count++){
								text+= "&#8226 "+res.extendedIngredients[count].originalString+"<br/>";
							}
							text+="</div></p><div class='row fixed'><div class='col rounded border-bottom'><h1 class='h4 border-bottom' style='padding-bottom:10px'>Instructions</h1><p>"+res.instructions+"</p></div></div>";
						titleCard.innerHTML = res.title + " <a id='star' role='button' style='text-decoration:none'>&#9734</a>";
						display.innerHTML+=text;
						favourite();
									$("#star").click(function(){
				let userInfo = localStorage.getItem('userInfo');
				if(userInfo) {
					userInfo = JSON.parse(userInfo);
					if(localStorage.getItem("saved") == "true") {
											$.ajax({
						url: '/api/user/removeRecipe',
						type: 'POST',
						contentType: 'application/json',
						data: JSON.stringify({"username": userInfo.user, "recipeId": recipeResult}),
						headers: {'x-access-token': userInfo.token},
						success: function(res){
								$("#star").html("&#9734");
								localStorage.setItem("saved", "false");
					}})
					} else {
						$.ajax({
						url: '/api/user/addRecipe',
						type: 'POST',
						contentType: 'application/json',
						data: JSON.stringify({"username": userInfo.user, "recipeId": recipeResult}),
						headers: {'x-access-token': userInfo.token},
						success: function(res){
								$("#star").html("&#9733");
								localStorage.setItem("saved", "true");
					}})
					}
				}else{
					window.location.href = "SignUp.html";
				}
			})
					}})
			}
			
			function favourite(){
				let userInfo = localStorage.getItem("userInfo");
				if(userInfo){
					userInfo = JSON.parse(userInfo);
					
					$.ajax({
						url: '/api/user/getUserRecipeIds',
						type: 'POST',
						contentType: 'application/json',
						data: JSON.stringify({"username": userInfo.user}),
						headers: {'x-access-token': userInfo.token},
						success: function(res){
							if(res.includes(recipeResult)) {
								$("#star").html("&#9733");
								localStorage.setItem("saved", "true");
							} else {
								$("#star").html("&#9734");
								localStorage.setItem("saved", "false");
							}
					}})
				}
			}
			
			function clearDisplay(){
				var display = document.getElementById("results");
				var titleCard = document.getElementById("titleCard");
				display.innerHTML = "";
				titleCard.innerHTML = "";
			}
			
			$("#logOutItem").click(function(){
				var status2 = processLogOut();
				if(status2 == 'false'){
					window.location.href = "index.html";
				}
			})
			
			$("#savedRecipes").click(function() {
				if(getUserStatus() == "true") {
					window.location.href = "SavedRecipes.html";
				} else {
					window.location.href = "SignUp.html";
				}
			})
			
			var testBtn = document.getElementById("testBtn");
			testBtn.addEventListener("click",getData(window.location.hash.substring(1)),false);			
			
		});
		</script>
	</body>
    
</html>
