<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
	<meta name="generator" content="Jekyll v3.8.5">
	<title>Account</title>

	<!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<style>
		.bd-placeholder-img {
			font-size: 1.125rem;
			text-anchor: middle;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			user-select: none;
		}

		@media (min-width: 768px) {
			.bd-placeholder-img-lg {
				font-size: 3.5rem;
			}
		}

		.sidenav {
			height: 120%;
			width: 0;
			position: fixed;
			z-index: 1;
			top: 0;
			right: 0;
			background-color: #ffffff;
			overflow-x: hidden;
			transition: 0.5s;
			padding-top: 80px;
		}

		.sidenav a {
			padding: 8px 8px 8px 32px;
			text-decoration: none;
			font-size: 25px;
			color: #818181;
			display: block;
			transition: 0.3s;
		}

		.sidenav a:hover {
			color: #f1f1f1;
		}

		.sidenav .closebtn {
			position: absolute;
			top: 0;
			right: 25px;
			font-size: 30px;
			margin-left: 50px;
			padding-top: 60px;
		}
	</style>
	<!-- Custom styles for this template -->
	<link href="jumbotron.css" rel="stylesheet">
</head>

<body>
	<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
		<a class="navbar-brand ml-3" href="index.html">&#10086; EasyMeals</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
			aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>

		<div class="collapse navbar-collapse" id="navbarsExampleDefault">
				<ul class="navbar-nav ml-auto mr-3 w-100 justify-content-end">
					<li class="nav-item active">
						<a class="nav-link" href="Index.html">Home <span class="sr-only">(current)</span></a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="Account.html">Account</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="SavedRecipes.html">Saved Recipes</a>
					</li>
					<li id="signInItem"	class="nav-item" style="padding-right: 20px">
						<a class="nav-link" onclick="openNavLog()">Sign in</a>
					</li>
					<li id="signUpItem"	class="nav-item active">
						<a class="nav-link btn-primary rounded" href="SignUp.html" role="button" style="width: 150px;text-align: center;">Sign up &#9753;</a>
					</li>
					<li id="logOutItem"	class="nav-item">
						<a class="nav-link" href="index.html">Log out</a>
					</li>
				</ul>
    
			</div>
	</nav>

	<main role="main">
		<!-- Main jumbotron for a primary marketing message or call to action -->
		<div class="jumbotron" style="margin-top: 30px;margin-left: 200px;background-color: #ffffff">
			<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom"
				style="width: 1000px">
				<h1 class="h2">Change Password</h1>

			</div>
			<div class="col-md-8 order-md-1">
				<!--form.needs-validation(novalidate='')-->
				<div class="row">
					<div class="mb-3"><label for="curPassword">Current Password</label><input class="form-control"
							id="curPassword" type="password" value="" required="">
						<div class="invalid-feedback">Please enter current password.</div>
					</div>
				</div>
				<div class="row">
					<div class="mb-3"><label for="newPassword">New Password</label><input class="form-control"
							id="newPassword" type="password" value="" required="">
						<div class="invalid-feedback">Please enter a new password.</div>
					</div>
				</div>
				<div class="row">
					<div class="mb-3"><label for="conNewPassword">Confirm New Password</label><input
							class="form-control" id="conNewPassword" type="password" value="" required="">
						<div class="invalid-feedback">Please enter your new password again.</div>
						<p id="errMessage" style="color:red;"></p>
					</div>
				</div>
				<p id="errMsg"></p>
			</div>

			<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-top"
				style="width: 980px">
				<button class="btn-group-lg" style="width: 150px;margin-top: 20px" id="passChange" type="submit">Change
					Password</button>
			</div>
			</form>
		</div>
		</div>
	</main>

	<!-- sideBar Registration/Login -->
	<div id="mySidenav" class="sidenav text-center border-left">
		<a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
		<div class="py-5 text-center">
			<h4 class="font-weight-bold">Welcome to EasyMeals</h4>
			<h5>Fill out the form to get started.</h5>
		</div>
		<div class="col-md-9 order-md-1" style="margin: auto">
			<form class="needs-validation" novalidate="" action="./Account_Reservations.html">
				<div class="mb-3">
					<label for="email">Email</label>
					<input type="email" class="form-control" id="email" placeholder="you@example.com" value=""
						required="">
					<div class="invalid-feedback">
						Please enter a valid email address.
					</div>
				</div>

				<div class="mb-3">
					<label for="password">Password <span class="text-muted">(8 or more characters)</span></label>
					<input type="password" class="form-control" id="password" placeholder="Password" value=""
						required="">
					<div class="invalid-feedback">
						Please enter a valid password.
					</div>
				</div>

				<div class="mb-3">
					<label for="conpassword">Confirm Password</label>
					<input type="password" class="form-control" id="conpassword" placeholder="Confirm Password" value=""
						required="">
					<div class="invalid-feedback">
						Please re-enter your password.
					</div>
				</div>

				<hr class="mb-4">
				<button class="btn btn-primary btn-lg btn-default" type="submit">Get Started</button>
			</form>
		</div>

		<div style="padding-top: 200px"></div>

		<div style="height: 200px;padding-top: 50px;background:url('Images/footer.jpg');background-size: contain;">
			<h6>Â© 2019 EasyMeals</h6>
		</div>

	</div>

	<footer class="container" style="margin-right: 520px">
		<p>&copy; EasyMeals 2019</p>
	</footer>

	<script src="./CSS/form-validation.js.download"></script>

	<script>
		function openNav() {
			document.getElementById("mySidenav").style.width = "500px";
		}

		function closeNav() {
			document.getElementById("mySidenav").style.width = "0";
		}		

		$(function () {
			var status = getUserStatus();
			console.log(status);
			if(status == 'true'){
				$("#signInItem").hide();
				$("#signUpItem").hide();
				$("#logOutItem").show();
			}else{
				$("#signInItem").show();
				$("#signUpItem").show();
				$("#logOutItem").hide();
			}
			
			$("#logOutItem").click(function(){
				processLogOut();
			})
			
			let enteredCurrentPassword, newPass, conPass;
			$("#passChange").click(function () {
				enteredCurrentPassword = $('#curPassword').val();
				newPass = $('#newPassword').val();
				conPass = $('#conNewPassword').val();
				if (newPass.length >= 8) {
					if (newPass != conPass) {
						$('#errMessage').html('New passwords do not match');
					} else {
						let token = localStorage.getItem('userInfo');
						token = JSON.parse(token);
						let username = token.user;
						token = token.token;
						$.ajax({
							url: '/api/user/changePassword',
							type: 'POST',
							contentType: 'application/json',
							data: JSON.stringify({
								username,
								enteredCurrentPassword,
								"newPassword": newPass
							}),
							headers: {"x-access-token": token},
							success: function (res) {
								$('#errMessage').html('Password changed').css("color", "green");
							},
							error: function (res) {
								$('#errMessage').html('Incorrect password');
							}
						})
					}
				} else {
					$('#errMessage').html('Password neeeds to be more than 7 characters');
				}
			})
		});
	</script>
</body>

</html>